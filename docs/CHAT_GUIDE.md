# ğŸ’¬ å¤šè½®å¯¹è¯ä½¿ç”¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è®­ç»ƒæ¨¡å‹ï¼ˆå¦‚æœè¿˜æ²¡æœ‰è®­ç»ƒè¿‡ï¼‰

```bash
python train.py
```

è®­ç»ƒå®Œæˆåä¼šè‡ªåŠ¨ä¿å­˜æ¨¡å‹åˆ° `model.pt`

### 2. å¯åŠ¨äº¤äº’å¼å¯¹è¯

```bash
python chat.py
```

ç„¶åå°±å¯ä»¥å¼€å§‹å¯¹è¯äº†ï¼

---

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### äº¤äº’å¼å¯¹è¯

```bash
$ python chat.py

ğŸ¤– æ­£åœ¨åŠ è½½æ¨¡å‹...
âœ… æˆåŠŸåŠ è½½æ¨¡å‹: model.pt
âœ… æ¨¡å‹åŠ è½½å®Œæˆï¼å¼€å§‹å¯¹è¯å§ï½

============================================================
ğŸ‰ æ¬¢è¿ä½¿ç”¨ Mini Transformer å¯¹è¯ç³»ç»Ÿï¼
============================================================

ğŸ’¡ ä½¿ç”¨è¯´æ˜:
  - è¾“å…¥æ–‡æœ¬ï¼Œæ¨¡å‹ä¼šç”Ÿæˆå›å¤
  - è¾“å…¥ 'quit' æˆ– 'exit' é€€å‡º
  - è¾“å…¥ 'history' æŸ¥çœ‹å¯¹è¯å†å²
  - è¾“å…¥ 'clear' æ¸…ç©ºå¯¹è¯å†å²
  - è¾“å…¥ 'help' æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯

============================================================

ğŸ‘¤ ä½ : a b c
ğŸ¤– æ¨¡å‹: c b a

ğŸ‘¤ ä½ : b a c
ğŸ¤– æ¨¡å‹: c a b

ğŸ‘¤ ä½ : history
ğŸ“ æœ€è¿‘ 2 è½®å¯¹è¯:
--------------------------------------------------
ğŸ‘¤ ç”¨æˆ·: a b c
ğŸ¤– æ¨¡å‹: c b a
ğŸ‘¤ ç”¨æˆ·: b a c
ğŸ¤– æ¨¡å‹: c a b
--------------------------------------------------

ğŸ‘¤ ä½ : quit
ğŸ‘‹ å†è§ï¼
```

---

## ğŸ¯ åŠŸèƒ½è¯´æ˜

### 1. åŸºæœ¬å¯¹è¯

ç›´æ¥è¾“å…¥æ–‡æœ¬ï¼Œæ¨¡å‹ä¼šç”Ÿæˆå›å¤ï¼š

```
ğŸ‘¤ ä½ : a b c
ğŸ¤– æ¨¡å‹: c b a
```

### 2. æŸ¥çœ‹å¯¹è¯å†å²

è¾“å…¥ `history` æŸ¥çœ‹æœ€è¿‘çš„å¯¹è¯ï¼š

```
ğŸ‘¤ ä½ : history
ğŸ“ æœ€è¿‘ 5 è½®å¯¹è¯:
--------------------------------------------------
ğŸ‘¤ ç”¨æˆ·: a b c
ğŸ¤– æ¨¡å‹: c b a
...
--------------------------------------------------
```

### 3. æ¸…ç©ºå¯¹è¯å†å²

è¾“å…¥ `clear` æ¸…ç©ºæ‰€æœ‰å¯¹è¯å†å²ï¼š

```
ğŸ‘¤ ä½ : clear
âœ… å¯¹è¯å†å²å·²æ¸…ç©º
```

### 4. é€€å‡ºå¯¹è¯

è¾“å…¥ `quit`ã€`exit` æˆ– `q` é€€å‡ºï¼š

```
ğŸ‘¤ ä½ : quit
ğŸ‘‹ å†è§ï¼
```

---

## ğŸ”§ é«˜çº§ç”¨æ³•

### åœ¨ä»£ç ä¸­ä½¿ç”¨

#### æ–¹å¼1ï¼šä½¿ç”¨ ChatBot ç±»

```python
from chat import ChatBot

# åˆ›å»ºå¯¹è¯æœºå™¨äºº
bot = ChatBot("model.pt")

# å•æ¬¡å¯¹è¯
response = bot.chat("a b c")
print(response)  # è¾“å‡º: c b a

# æŸ¥çœ‹å†å²
bot.show_history()

# æ¸…ç©ºå†å²
bot.clear_history()
```

#### æ–¹å¼2ï¼šç›´æ¥ä½¿ç”¨æ¨ç†å‡½æ•°

```python
from inference import load_model, predict

# åŠ è½½æ¨¡å‹
model = load_model("model.pt")

# é¢„æµ‹
result = predict(model, "a b c")
print(result)  # è¾“å‡º: c b a
```

#### æ–¹å¼3ï¼šæ‰¹é‡å¯¹è¯

```python
from chat import batch_chat

# æ‰¹é‡å¤„ç†å¤šä¸ªè¾“å…¥
inputs = ["a b c", "b a c", "c a b"]
batch_chat("model.pt", inputs)
```

---

## ğŸ“ å¯¹è¯å†å²ç®¡ç†

### å¯¹è¯å†å²å­˜å‚¨

`ChatBot` ç±»ä¼šè‡ªåŠ¨è®°å½•æ‰€æœ‰å¯¹è¯ï¼š

```python
bot = ChatBot("model.pt")

bot.chat("a b c")  # ç¬¬1è½®
bot.chat("b a c")  # ç¬¬2è½®

# æŸ¥çœ‹å†å²
bot.show_history(10)  # æ˜¾ç¤ºæœ€è¿‘10è½®
```

### å†å²æ•°æ®ç»“æ„

```python
# conversation_history æ˜¯ä¸€ä¸ªåˆ—è¡¨
[
    ("ç”¨æˆ·", "a b c"),      # ç”¨æˆ·è¾“å…¥
    ("æ¨¡å‹", "c b a"),      # æ¨¡å‹å›å¤
    ("ç”¨æˆ·", "b a c"),      # ä¸‹ä¸€è½®ç”¨æˆ·è¾“å…¥
    ("æ¨¡å‹", "c a b"),      # ä¸‹ä¸€è½®æ¨¡å‹å›å¤
    ...
]
```

---

## âš™ï¸ é…ç½®é€‰é¡¹

### ä¿®æ”¹æ¨¡å‹è·¯å¾„

åœ¨ `config.py` ä¸­ä¿®æ”¹ï¼š

```python
MODEL_SAVE_PATH = "my_model.pt"  # è‡ªå®šä¹‰æ¨¡å‹è·¯å¾„
```

### ä¿®æ”¹æœ€å¤§ç”Ÿæˆé•¿åº¦

åœ¨ `inference.py` çš„ `predict` å‡½æ•°ä¸­ï¼š

```python
def predict(model, input_text, max_length=20):  # é»˜è®¤10ï¼Œå¯ä»¥æ”¹å¤§
    ...
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨ï¼Ÿ

**é”™è¯¯ä¿¡æ¯ï¼š**
```
âŒ æ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨ï¼
   è¯·å…ˆè¿è¡Œ: python train.py
```

**è§£å†³æ–¹æ³•ï¼š**
å…ˆè¿è¡Œ `python train.py` è®­ç»ƒæ¨¡å‹

---

### Q2: æ¨¡å‹åŠ è½½å¤±è´¥ï¼Ÿ

**å¯èƒ½åŸå› ï¼š**
1. æ¨¡å‹æ–‡ä»¶æŸå
2. æ¨¡å‹æ¶æ„ä¸åŒ¹é…ï¼ˆä¿®æ”¹äº†æ¨¡å‹ç»“æ„ä½†æ²¡é‡æ–°è®­ç»ƒï¼‰

**è§£å†³æ–¹æ³•ï¼š**
åˆ é™¤ `model.pt`ï¼Œé‡æ–°è¿è¡Œ `python train.py`

---

### Q3: ç”Ÿæˆçš„å›å¤ä¸ºç©ºï¼Ÿ

**å¯èƒ½åŸå› ï¼š**
1. è¾“å…¥æ–‡æœ¬ä¸åœ¨è¯æ±‡è¡¨ä¸­
2. æ¨¡å‹è®­ç»ƒä¸å……åˆ†

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥è¾“å…¥æ˜¯å¦åŒ…å«è¯æ±‡è¡¨ä¸­çš„tokenï¼ˆa, b, c, 1, 2, 3ï¼‰
2. å¢åŠ è®­ç»ƒè½®æ•°ï¼ˆåœ¨ `config.py` ä¸­è®¾ç½® `EPOCHS = 300`ï¼‰

---

### Q4: å¦‚ä½•ä¿å­˜å¯¹è¯å†å²ï¼Ÿ

å¯ä»¥æ‰©å±• `ChatBot` ç±»ï¼Œæ·»åŠ ä¿å­˜åŠŸèƒ½ï¼š

```python
import json

def save_history(self, filepath="history.json"):
    with open(filepath, 'w', encoding='utf-8') as f:
        json.dump(self.conversation_history, f, ensure_ascii=False, indent=2)

def load_history(self, filepath="history.json"):
    with open(filepath, 'r', encoding='utf-8') as f:
        self.conversation_history = json.load(f)
```

---

## ğŸ“ è¿›é˜¶æŠ€å·§

### 1. è‡ªå®šä¹‰ç”Ÿæˆç­–ç•¥

ä¿®æ”¹ `inference.py` ä¸­çš„ `predict` å‡½æ•°ï¼Œä½¿ç”¨ä¸åŒçš„è§£ç ç­–ç•¥ï¼š

```python
# Greedy decoding (å½“å‰ä½¿ç”¨)
next_token = torch.argmax(logits[0, -1], dim=-1).item()

# å¯ä»¥æ”¹ä¸º Top-k sampling
top_k = 3
top_k_logits, top_k_indices = torch.topk(logits[0, -1], top_k)
next_token = top_k_indices[torch.multinomial(torch.softmax(top_k_logits, dim=-1), 1)].item()
```

### 2. æ·»åŠ æ¸©åº¦æ§åˆ¶

```python
def predict_with_temperature(model, input_text, temperature=1.0):
    # temperature > 1: æ›´éšæœº
    # temperature < 1: æ›´ç¡®å®š
    logits = logits / temperature
    ...
```

### 3. æµå¼è¾“å‡º

ä¿®æ”¹ `predict` å‡½æ•°ï¼Œæ”¯æŒå®æ—¶è¾“å‡ºï¼š

```python
def predict_streaming(model, input_text, callback=None):
    # callback æ˜¯æ¯æ¬¡ç”Ÿæˆtokenæ—¶è°ƒç”¨çš„å‡½æ•°
    for token in generated:
        if callback:
            callback(token)
        ...
```

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `inference.py`: æ¨ç†æ¨¡å—ï¼ˆæ¨¡å‹é¢„æµ‹ï¼‰
- `chat.py`: å¯¹è¯æ¨¡å—ï¼ˆäº¤äº’å¼ç•Œé¢ï¼‰
- `train.py`: è®­ç»ƒæ¨¡å—ï¼ˆè‡ªåŠ¨ä¿å­˜æ¨¡å‹ï¼‰
- `config.py`: é…ç½®æ–‡ä»¶ï¼ˆæ¨¡å‹è·¯å¾„ç­‰ï¼‰

---

**ç°åœ¨ä½ å¯ä»¥ä¸è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œå¤šè½®å¯¹è¯äº†ï¼** ğŸ‰

